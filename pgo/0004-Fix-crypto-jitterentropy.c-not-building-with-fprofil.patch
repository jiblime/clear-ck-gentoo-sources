From 1eaa9d10a4876eefa1cce0a57f7e7647fb3cc753 Mon Sep 17 00:00:00 2001
From: Jarmo Tiitto <jarmo.tiitto@gmail.com>
Date: Wed, 31 May 2017 09:10:45 +0300
Subject: [PATCH 04/21] Fix crypto/jitterentropy.c not building with
 -fprofile-generate.

---
 crypto/Makefile        | 1 +
 crypto/jitterentropy.c | 4 +++-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/crypto/Makefile b/crypto/Makefile
index f6a234d08882..4a08b30e5d7a 100644
--- a/crypto/Makefile
+++ b/crypto/Makefile
@@ -133,6 +133,7 @@ obj-$(CONFIG_CRYPTO_ANSI_CPRNG) += ansi_cprng.o
 obj-$(CONFIG_CRYPTO_DRBG) += drbg.o
 obj-$(CONFIG_CRYPTO_JITTERENTROPY) += jitterentropy_rng.o
 CFLAGS_jitterentropy.o = -O0
+CFLAGS_GCOV_jitterentropy.o = -O0
 jitterentropy_rng-y := jitterentropy.o jitterentropy-kcapi.o
 obj-$(CONFIG_CRYPTO_TEST) += tcrypt.o
 obj-$(CONFIG_CRYPTO_GHASH) += ghash-generic.o
diff --git a/crypto/jitterentropy.c b/crypto/jitterentropy.c
index acf44b2d2d1d..3c256adf03f9 100644
--- a/crypto/jitterentropy.c
+++ b/crypto/jitterentropy.c
@@ -51,9 +51,11 @@
  */
 
 #ifdef __OPTIMIZE__
- #error "The CPU Jitter random number generator must not be compiled with optimizations. See documentation. Use the compiler switch -O0 for compiling jitterentropy.c."
+ #warning "The CPU Jitter random number generator must not be compiled with optimizations. See documentation. Use the compiler switch -O0 for compiling jitterentropy.c."
+ #pragma GCC optimize "-O0"	/* Force compiler to disable optimizations */
 #endif
 
+
 typedef	unsigned long long	__u64;
 typedef	long long		__s64;
 typedef	unsigned int		__u32;
-- 
2.19.2

