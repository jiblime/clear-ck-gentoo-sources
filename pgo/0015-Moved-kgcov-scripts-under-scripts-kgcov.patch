From 3f746a4440b641c92368bb17d0b088416fb0cb1b Mon Sep 17 00:00:00 2001
From: Jarmo Tiitto <jarmo.tiitto@gmail.com>
Date: Thu, 3 May 2018 19:40:55 +0300
Subject: [PATCH 15/21] Moved kgcov scripts under scripts/kgcov/

---
 buildGCOVKernel => scripts/kgcov/buildGCOVKernel           | 6 +++---
 calcsum-4.9.cpp => scripts/kgcov/calcsum-4.9.cpp           | 0
 gather.sh => scripts/kgcov/gather.sh                       | 0
 gathergcno.sh => scripts/kgcov/gathergcno.sh               | 0
 genPGOKernel => scripts/kgcov/genPGOKernel                 | 6 +++---
 mergegcov.sh => scripts/kgcov/mergegcov.sh                 | 0
 processGCOVMakefiles => scripts/kgcov/processGCOVMakefiles | 0
 rename.sh => scripts/kgcov/rename.sh                       | 0
 8 files changed, 6 insertions(+), 6 deletions(-)
 rename buildGCOVKernel => scripts/kgcov/buildGCOVKernel (82%)
 rename calcsum-4.9.cpp => scripts/kgcov/calcsum-4.9.cpp (100%)
 rename gather.sh => scripts/kgcov/gather.sh (100%)
 rename gathergcno.sh => scripts/kgcov/gathergcno.sh (100%)
 rename genPGOKernel => scripts/kgcov/genPGOKernel (95%)
 rename mergegcov.sh => scripts/kgcov/mergegcov.sh (100%)
 rename processGCOVMakefiles => scripts/kgcov/processGCOVMakefiles (100%)
 rename rename.sh => scripts/kgcov/rename.sh (100%)

diff --git a/buildGCOVKernel b/scripts/kgcov/buildGCOVKernel
similarity index 82%
rename from buildGCOVKernel
rename to scripts/kgcov/buildGCOVKernel
index 2d50ae9a3855..0fdddf46b8ce 100755
--- a/buildGCOVKernel
+++ b/scripts/kgcov/buildGCOVKernel
@@ -6,8 +6,8 @@ KGCCVER=/opt/kgcc-7.2/bin/
 # without it the generated profile data is useless.
 DIR=$PWD
 mkdir -p /tmp/kernelsrc >/dev/null 2>&1
-[ -f /tmp/kernelsrc/buildGCOVKernel ] || sudo mount --rbind $PWD /tmp/kernelsrc
-[ -f /tmp/kernelsrc/buildGCOVKernel ] || { echo "Failed to link $PWD to /tmp/kernelsrc"; exit 1; }
+[ -f /tmp/kernelsrc/scripts/kgcov/buildGCOVKernel ] || sudo mount --rbind $PWD /tmp/kernelsrc
+[ -f /tmp/kernelsrc/scripts/kgcov/buildGCOVKernel ] || { echo "Failed to link $PWD to /tmp/kernelsrc"; exit 1; }
 
 # Clean-up the mount on exit.
 cleanup() {
@@ -30,7 +30,7 @@ echo 'Building Instrumented Kernel.'
 make $@  V=2 CC=$KGCCVER/kgcc AR=$KGCCVER/kgcc-ar NM=$KGCCVER/kgcc-nm
 if [ $? -eq 0 ]; then
     echo 'Kernel build okay!'
-    ./gathergcno.sh gcnoprofile.tar.gz
+    ./scripts/kgcov/gathergcno.sh gcnoprofile.tar.gz
     exit 0
 else
     echo 'Kernel build failed. Stop.'
diff --git a/calcsum-4.9.cpp b/scripts/kgcov/calcsum-4.9.cpp
similarity index 100%
rename from calcsum-4.9.cpp
rename to scripts/kgcov/calcsum-4.9.cpp
diff --git a/gather.sh b/scripts/kgcov/gather.sh
similarity index 100%
rename from gather.sh
rename to scripts/kgcov/gather.sh
diff --git a/gathergcno.sh b/scripts/kgcov/gathergcno.sh
similarity index 100%
rename from gathergcno.sh
rename to scripts/kgcov/gathergcno.sh
diff --git a/genPGOKernel b/scripts/kgcov/genPGOKernel
similarity index 95%
rename from genPGOKernel
rename to scripts/kgcov/genPGOKernel
index cda87a094284..010957ccd7b6 100755
--- a/genPGOKernel
+++ b/scripts/kgcov/genPGOKernel
@@ -7,7 +7,7 @@ KGCCVER=/opt/kgcc-7.2/bin
 echo 'Initializing kernel PGO optimization..'
 DIR=$PWD
 mkdir -p /tmp/kernelsrc
-[ -f /tmp/kernelsrc/genPGOKernel ] || sudo mount --rbind $DIR /tmp/kernelsrc
+[ -f /tmp/kernelsrc/scripts/kgcov/genPGOKernel ] || sudo mount --rbind $DIR /tmp/kernelsrc
 cd /tmp/kernelsrc
 
 die() {
@@ -47,7 +47,7 @@ if [ ! -f $CHECKPROF/mm/.tmp_mmap.gcda ]; then
     rm -rf $CHECKPROF/arch/x86
     echo 'Postprocesing profile data with calcsum..'
     find /tmp/kernelPGOdump -name '*.gcda' > list.txt
-    ./calcsum list.txt >/dev/null
+    ./scripts/kgcov/calcsum list.txt >/dev/null
     rm -f list.txt
 
     # run gcov-tool rewrite -s 1.0
@@ -60,7 +60,7 @@ if [ ! -f $CHECKPROF/mm/.tmp_mmap.gcda ]; then
     $KGCCVER/kgcov-tool rewrite -s 1.0 -o /tmp/kernelPGOdump/ /tmp/kernelPGOdump/
 
     echo 'Adjusting profile data file names..'
-    find /tmp/kernelPGOdump/* -name '*.gcda' -print0 | xargs -0 -n1 -P0 ./rename.sh
+    find /tmp/kernelPGOdump/* -name '*.gcda' -print0 | xargs -0 -n1 -P0 ./scripts/kgcov/rename.sh
 
 else
     echo 'NOTE: Using alredy configured profile data.'
diff --git a/mergegcov.sh b/scripts/kgcov/mergegcov.sh
similarity index 100%
rename from mergegcov.sh
rename to scripts/kgcov/mergegcov.sh
diff --git a/processGCOVMakefiles b/scripts/kgcov/processGCOVMakefiles
similarity index 100%
rename from processGCOVMakefiles
rename to scripts/kgcov/processGCOVMakefiles
diff --git a/rename.sh b/scripts/kgcov/rename.sh
similarity index 100%
rename from rename.sh
rename to scripts/kgcov/rename.sh
-- 
2.19.2

